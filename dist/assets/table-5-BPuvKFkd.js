import{v as o,r,bD as ce,aJ as Oe,bO as Pe,j as t,bd as te,W as Te,ai as Ae,K as S,t as E,F,S as ae,I as M,bQ as Le,T as x,B as d,bR as Ie,aK as we,aL as ze,am as $e,ao as Ke,au as ne,aj as Ne,b as Re,M as Be,D as se}from"./index-C5-7V04H.js";import{t as Ze}from"./Check-BMNnZQ-D.js";import{w as Qe,L as He}from"./MagnifyingGlass-BmE9XFG2.js";import{P as We}from"./PencilSimple-D7AjZ8DX.js";import{D as Ye}from"./data-table-XenAvZ69.js";import{O as D}from"./option-BD2v2nDd.js";import{C as k}from"./Card-D72Z6VP3.js";import{F as Ue}from"./FormGroup-R3IoemcS.js";import{T as Je}from"./TablePagination-CjbpsP_k.js";const Ve=new Map([["bold",o.createElement(o.Fragment,null,o.createElement("path",{d:"M216.49,168.49a12,12,0,0,1-17,0L128,97,56.49,168.49a12,12,0,0,1-17-17l80-80a12,12,0,0,1,17,0l80,80A12,12,0,0,1,216.49,168.49Z"}))],["duotone",o.createElement(o.Fragment,null,o.createElement("path",{d:"M208,160H48l80-80Z",opacity:"0.2"}),o.createElement("path",{d:"M213.66,154.34l-80-80a8,8,0,0,0-11.32,0l-80,80A8,8,0,0,0,48,168H208a8,8,0,0,0,5.66-13.66ZM67.31,152,128,91.31,188.69,152Z"}))],["fill",o.createElement(o.Fragment,null,o.createElement("path",{d:"M215.39,163.06A8,8,0,0,1,208,168H48a8,8,0,0,1-5.66-13.66l80-80a8,8,0,0,1,11.32,0l80,80A8,8,0,0,1,215.39,163.06Z"}))],["light",o.createElement(o.Fragment,null,o.createElement("path",{d:"M212.24,164.24a6,6,0,0,1-8.48,0L128,88.49,52.24,164.24a6,6,0,0,1-8.48-8.48l80-80a6,6,0,0,1,8.48,0l80,80A6,6,0,0,1,212.24,164.24Z"}))],["regular",o.createElement(o.Fragment,null,o.createElement("path",{d:"M213.66,165.66a8,8,0,0,1-11.32,0L128,91.31,53.66,165.66a8,8,0,0,1-11.32-11.32l80-80a8,8,0,0,1,11.32,0l80,80A8,8,0,0,1,213.66,165.66Z"}))],["thin",o.createElement(o.Fragment,null,o.createElement("path",{d:"M210.83,162.83a4,4,0,0,1-5.66,0L128,85.66,50.83,162.83a4,4,0,0,1-5.66-5.66l80-80a4,4,0,0,1,5.66,0l80,80A4,4,0,0,1,210.83,162.83Z"}))]]);var Ge=Object.defineProperty,Xe=Object.defineProperties,qe=Object.getOwnPropertyDescriptors,re=Object.getOwnPropertySymbols,et=Object.prototype.hasOwnProperty,tt=Object.prototype.propertyIsEnumerable,le=(s,a,l)=>a in s?Ge(s,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[a]=l,at=(s,a)=>{for(var l in a||(a={}))et.call(a,l)&&le(s,l,a[l]);if(re)for(var l of re(a))tt.call(a,l)&&le(s,l,a[l]);return s},nt=(s,a)=>Xe(s,qe(a));const me=r.forwardRef((s,a)=>o.createElement(ce,nt(at({ref:a},s),{weights:Ve})));me.displayName="CaretUp";var st=Object.defineProperty,rt=Object.defineProperties,lt=Object.getOwnPropertyDescriptors,ie=Object.getOwnPropertySymbols,it=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable,oe=(s,a,l)=>a in s?st(s,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[a]=l,ct=(s,a)=>{for(var l in a||(a={}))it.call(a,l)&&oe(s,l,a[l]);if(ie)for(var l of ie(a))ot.call(a,l)&&oe(s,l,a[l]);return s},mt=(s,a)=>rt(s,lt(a));const ue=r.forwardRef((s,a)=>o.createElement(ce,mt(ct({ref:a},s),{weights:Ze})));ue.displayName="Check";const ut=["Select Field","Dataset","Table Name","Field Name","Data Type","Field Description","Primary Key","Foreign Key","Field Mode","Actions","Access Instructions"],dt=["Dataset","Table Name","Field Name","Field Description"],vt=r.forwardRef(function(a,l){const{schemaData:g,isSchemaLoading:I,schemaError:w}=r.useContext(Oe),[u,f]=r.useState([]),[O,z]=r.useState([]);r.useEffect(()=>{var e,n;if(g&&Array.isArray(g)){const i=g.map(c=>({...c,description:c.description??null,collation_name:c.collation_name??null,rounding_mode:c.rounding_mode??null,primary_key:c.primary_key??!1,foreign_key:c.foreign_key??!1,field_mode:c.field_mode??"NULLABLE"}));f(i),z(i),(e=a.onModifiedStatusChange)==null||e.call(a,!1)}else f([]),z([]),(n=a.onModifiedStatusChange)==null||n.call(a,!1)},[g,a.onModifiedStatusChange]),r.useImperativeHandle(l,()=>({getAugmentedData:()=>u,revertToOriginal:()=>{var e;f([...O]),(e=a.onModifiedStatusChange)==null||e.call(a,!1)},updateDataExternally:e=>{var i;f(e);let n=!1;e.length===O.length?JSON.stringify(e)!==JSON.stringify(O)&&(n=!0):n=!0,(i=a.onModifiedStatusChange)==null||i.call(a,n)}}));const{columns:$,addColumnToQuery:K,removeColumnFromQuery:N,setTableName:R}=Pe(),[h,P]=r.useState(null),[y,B]=r.useState(""),[j,Z]=r.useState(!1),[b,Q]=r.useState(!1),[_,de]=r.useState(""),[v,fe]=r.useState(""),[C,he]=r.useState(""),[T,pe]=r.useState(!1),[H,W]=r.useState(0),[A,xe]=r.useState(10),[L,ge]=r.useState(dt),[Y,U]=r.useState(null),[J,ye]=r.useState(null);function je(e){U(e.currentTarget)}function be(){U(null)}function _e(e){ge(n=>n.includes(e)?n.filter(i=>i!==e):[...n,e])}function ve(e){ye(n=>n===e?null:e)}function Ce(e){return e.field_path&&e.field_path!==e.column_name?e.field_path:e.table_name.includes("*")?`${e.column_name}`:`${e.table_schema}.${e.table_name}.${e.column_name}`}const V=r.useMemo(()=>[{name:"Select Field",align:"center",width:60,formatter:e=>{var c,m;const n=((c=e.access_instructions)==null?void 0:c.from_clause)||`${e.table_schema}.${e.table_name}`,i=((m=e.access_instructions)==null?void 0:m.select_expr)||Ce(e);return t.jsx(te,{size:"small",checked:$.includes(i),onChange:p=>{p.target.checked?(R(n),K(i)):N(i)}})}},{name:"Dataset",formatter:e=>e.table_schema,width:160},{name:"Table Name",formatter:e=>t.jsx(Te,{color:"text.primary",underline:"none",variant:"subtitle2",children:e.table_name}),width:160},{name:"Field Name",formatter:e=>e.column_name,width:160},{name:"Data Type",width:120,formatter:e=>e.data_type||""},{name:"Field Description",width:220,formatter:e=>{const n=e.table_name+"."+e.column_name;return h===n?t.jsx(Ae,{size:"small",fullWidth:!0,value:y,onChange:i=>B(i.target.value)}):e.description||""}},{name:"Primary Key",width:120,formatter:e=>{const n=e.table_name+"."+e.column_name;return h===n?t.jsxs(S,{size:"small",value:j?"yes":"no",onChange:i=>Z(i.target.value==="yes"),children:[t.jsx(E,{value:"yes",children:"Yes"}),t.jsx(E,{value:"no",children:"No"})]}):e.primary_key?t.jsx(F,{label:"Yes",color:"success",size:"small",variant:"soft"}):t.jsx(F,{label:"No",size:"small",variant:"soft"})}},{name:"Foreign Key",width:120,formatter:e=>{const n=e.table_name+"."+e.column_name;return h===n?t.jsxs(S,{size:"small",value:b?"yes":"no",onChange:i=>Q(i.target.value==="yes"),children:[t.jsx(E,{value:"yes",children:"Yes"}),t.jsx(E,{value:"no",children:"No"})]}):e.foreign_key?t.jsx(F,{label:"Yes",color:"warning",size:"small",variant:"soft"}):t.jsx(F,{label:"No",size:"small",variant:"soft"})}},{name:"Field Mode",width:120,formatter:e=>e.field_mode||""},{name:"Actions",align:"right",hideName:!0,width:80,formatter:e=>{const n=e.table_name+"."+e.column_name;return h===n?t.jsxs(ae,{direction:"row",spacing:1,children:[t.jsx(M,{onClick:()=>De(n),color:"primary",children:t.jsx(ue,{size:18})}),t.jsx(M,{onClick:ke,color:"inherit",children:t.jsx(Le,{size:18})})]}):t.jsx(M,{onClick:()=>Me(e),children:t.jsx(We,{})})}},{name:"Access Instructions",width:180,formatter:(e,n)=>{var m,p,q,ee;const i=J===n;return((m=e.access_instructions)==null?void 0:m.from_clause)||((p=e.access_instructions)==null?void 0:p.select_expr)?t.jsxs(d,{children:[t.jsx(M,{size:"small",onClick:()=>ve(n),children:i?t.jsx(me,{}):t.jsx(Ie,{})}),t.jsx(we,{in:i,timeout:"auto",unmountOnExit:!0,children:t.jsxs(d,{sx:{p:1,borderLeft:"1px solid var(--mui-palette-divider)",ml:1,mt:.5,fontSize:"0.75rem"},children:[((q=e.access_instructions)==null?void 0:q.from_clause)&&t.jsxs(t.Fragment,{children:[" ",t.jsx(x,{variant:"caption",component:"div",fontWeight:"medium",children:"FROM Clause:"})," ",t.jsxs(x,{variant:"caption",component:"div",sx:{fontFamily:"monospace",whiteSpace:"pre-wrap",wordBreak:"break-all"},children:[" ",e.access_instructions.from_clause," "]})," "]}),((ee=e.access_instructions)==null?void 0:ee.select_expr)&&t.jsxs(t.Fragment,{children:[" ",t.jsx(x,{variant:"caption",component:"div",fontWeight:"medium",sx:{mt:.5},children:"SELECT Expr:"})," ",t.jsxs(x,{variant:"caption",component:"div",sx:{fontFamily:"monospace",whiteSpace:"pre-wrap",wordBreak:"break-all"},children:[" ",e.access_instructions.select_expr," "]})," "]})]})})]}):t.jsx(x,{variant:"caption",color:"text.secondary",children:"N/A"})}}],[h,y,j,b,$,J,K,N,R]),Se=r.useMemo(()=>V.filter(e=>L.includes(e.name)),[V,L]),G=r.useMemo(()=>u.filter(e=>!(v&&e.table_name!==v||C&&e.table_schema!==C||T&&!e.description||_&&!`${e.table_schema} ${e.table_name} ${e.column_name} ${e.description||""}`.toLowerCase().includes(_.toLowerCase()))),[u,v,C,T,_]),Ee=G.length,X=H*A,Fe=G.slice(X,X+A);if(I)return t.jsx(d,{sx:{p:3},children:t.jsxs(k,{sx:{p:3},children:[t.jsx(ze,{})," Loading schema..."]})});if(w)return t.jsx(d,{sx:{p:3},children:t.jsxs(k,{sx:{p:3,color:"error.main"},children:["Error: ",w]})});if(u.length===0&&!I)return t.jsx(d,{sx:{p:3},children:t.jsx(k,{sx:{p:3},children:"No schema loaded or available."})});function Me(e){const n=e.table_name+"."+e.column_name;P(n),B(e.description||""),Z(!!e.primary_key),Q(!!e.foreign_key)}function De(e){var c;let n=!1;const i=u.map(m=>m.table_name+"."+m.column_name===e?((m.description!==y||!!m.primary_key!==j||!!m.foreign_key!==b)&&(n=!0),{...m,description:y,primary_key:j,foreign_key:b}):m);n&&(f(i),(c=a.onModifiedStatusChange)==null||c.call(a,!0)),P(null)}function ke(){P(null)}return t.jsx(d,{sx:{bgcolor:"var(--mui-palette-background-level1)",p:3},children:t.jsxs(k,{children:[t.jsxs(ae,{direction:"row",spacing:2,sx:{alignItems:"center",flexWrap:"wrap",p:3},children:[t.jsx($e,{placeholder:"Search fields...",value:_,onChange:e=>de(e.target.value),startAdornment:t.jsx(Ke,{position:"start",children:t.jsx(Qe,{fontSize:"var(--icon-fontSize-md)"})}),sx:{width:{xs:"100%",sm:300}}}),t.jsxs(S,{value:v,onChange:e=>fe(e.target.value),displayEmpty:!0,sx:{width:{xs:"100%",sm:200}},size:"small",children:[t.jsx(D,{value:"",children:"All Tables"}),[...new Set(u.map(e=>e.table_name))].sort().map(e=>t.jsx(D,{value:e,children:e},e))]}),t.jsxs(S,{value:C,onChange:e=>he(e.target.value),displayEmpty:!0,sx:{width:{xs:"100%",sm:200}},size:"small",children:[t.jsx(D,{value:"",children:"All Datasets"}),[...new Set(u.map(e=>e.table_schema))].sort().map(e=>t.jsx(D,{value:e,children:e},e))]}),t.jsx(ne,{control:t.jsx(Ne,{checked:T,onChange:e=>pe(e.target.checked)}),label:"Missing Desc.",sx:{"& .MuiTypography-root":{fontSize:"0.875rem"}}}),t.jsx(Re,{variant:"outlined",startIcon:t.jsx(He,{}),onClick:je,size:"small",children:"Columns"}),t.jsx(Be,{anchorEl:Y,open:!!Y,onClose:be,children:t.jsx(Ue,{sx:{p:1,maxHeight:300,overflowY:"auto"},children:ut.map(e=>t.jsx(ne,{control:t.jsx(te,{size:"small",checked:L.includes(e),onChange:()=>_e(e)}),label:e,sx:{"& .MuiTypography-root":{fontSize:"0.875rem"}}},e))})})]}),t.jsx(se,{}),t.jsx(d,{sx:{overflowX:"auto"},children:t.jsx(Ye,{columns:Se,rows:Fe})}),t.jsx(se,{}),t.jsx(Je,{component:"div",count:Ee,page:H,onPageChange:(e,n)=>W(n),rowsPerPage:A,onRowsPerPageChange:e=>{xe(Number.parseInt(e.target.value,10)),W(0)},rowsPerPageOptions:[5,10,25,50,100]})]})})});export{vt as T};
