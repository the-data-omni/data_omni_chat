import{r as a,j as t,B as A,bm as me,bn as pe,aL as he,T as O,S as F,am as R,ao as _,b as w,D as b,K as B,t as p,au as J,aj as ge,M as fe,bd as xe}from"./index-C5-7V04H.js";import{w as U,L as Se}from"./MagnifyingGlass-BmE9XFG2.js";import{D as je}from"./data-table-XenAvZ69.js";import{C as Ce}from"./Card-D72Z6VP3.js";import{F as we}from"./FormGroup-R3IoemcS.js";import{T as be}from"./TablePagination-CjbpsP_k.js";function ve(n){return n.flatMap(o=>o.columns.map(l=>({tableName:o.table_name,sourceName:o.source_name,link:o.link,columnName:l.column_name,columnDesc:l.description})))}const q=["Table Name","Source Name","Column Name","Description"],Ne=[...q],W=["Launching headless browser...","Navigating to page...","Collecting table data...","Processing columns...","Collecting and Formatting Data..."],ye=[{name:"Table Name",field:"tableName",width:"180px"},{name:"Source Name",width:"180px",formatter:n=>n.link?t.jsx("a",{href:n.link,target:"_blank",rel:"noreferrer",children:n.sourceName}):n.sourceName},{name:"Column Name",field:"columnName",width:"180px"},{name:"Description",field:"columnDesc",width:"300px"}];function Me(){const[n,o]=a.useState([]);a.useEffect(()=>{try{const e=localStorage.getItem("scrapedData");if(e){const s=JSON.parse(e);o(s)}}catch(e){console.error("Error reading from localStorage:",e)}},[]);const[l,v]=a.useState(!1),[N,y]=a.useState(""),[h,z]=a.useState(""),[G,I]=a.useState(""),[Q,D]=a.useState(!1),[V,g]=a.useState(0),[f,K]=a.useState(Ne),[P,L]=a.useState(null),[u,X]=a.useState(""),[d,$]=a.useState(""),[m,H]=a.useState(""),[x,Y]=a.useState(!1),[k,S]=a.useState(0),[j,Z]=a.useState(10);a.useEffect(()=>{let e;return l?(D(!0),g(0),e=setInterval(()=>{g(s=>s<W.length-1?s+1:s)},1500)):(D(!1),g(0)),()=>{e&&clearInterval(e)}},[l]);async function ee(){y(""),I(""),S(0);try{o([]);const e=await fetch("http://127.0.0.1:8000/api/scrape_screenshot",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:h})});if(!e.ok){const i=await e.json();throw new Error(i.error||"Failed to get screenshot")}const s=await e.json();I(s.screenshot||""),v(!0);const r=await fetch("http://127.0.0.1:8000/api/scrape",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:h})});if(!r.ok){const i=await r.json();throw new Error(i.error||"Failed to get data")}const c=await r.json(),C=ve(c);o(C)}catch(e){y(e.message||"Network error")}finally{v(!1)}}function te(){if(!n.length){alert("No scraped data to save.");return}try{let e=[];const s=localStorage.getItem("scrapedData");s&&(e=JSON.parse(s));const r=[...e];for(const c of n){const C=c.tableName.toLowerCase(),i=c.columnName.toLowerCase();r.find(M=>M.tableName.toLowerCase()===C&&M.columnName.toLowerCase()===i)||r.push(c)}localStorage.setItem("scrapedData",JSON.stringify(r)),o(r),alert("Scraped data appended to localStorage (case-insensitive)!")}catch(e){console.error("Error saving to localStorage:",e),alert("Error saving to localStorage. See console for details.")}}function ae(e){L(e.currentTarget)}function se(){L(null)}function ne(e){K(s=>s.includes(e)?s.filter(r=>r!==e):[...s,e])}function re(e,s){S(s)}function oe(e){Z(parseInt(e.target.value,10)),S(0)}const le=a.useMemo(()=>Array.from(new Set(n.map(e=>e.tableName))),[n]),ce=a.useMemo(()=>Array.from(new Set(n.map(e=>e.sourceName))),[n]),T=a.useMemo(()=>n.filter(e=>!(d&&e.tableName!==d||m&&e.sourceName!==m||x&&e.columnDesc||u&&!(e.tableName+e.sourceName+e.columnName+e.columnDesc).toLowerCase().includes(u.toLowerCase()))),[n,d,m,x,u]),ie=T.length,E=k*j,ue=T.slice(E,E+j),de=a.useMemo(()=>ye.filter(e=>f.includes(e.name)),[f]);return t.jsx(A,{sx:{bgcolor:"var(--mui-palette-background-level1)",p:3},children:t.jsxs(Ce,{children:[t.jsx(me,{open:Q,PaperProps:{sx:{width:"40vw",height:"40vh",maxWidth:"none",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",backgroundImage:`url(${G||"https://via.placeholder.com/600x400?text=Page+Screenshot"})`,backgroundSize:"cover",backgroundPosition:"center","&::before":{content:'""',position:"absolute",inset:0,bgcolor:"rgba(0,0,0,0.4)"},overflow:"hidden"}},BackdropProps:{sx:{backdropFilter:"blur(3px)"}},children:t.jsxs(pe,{sx:{textAlign:"center",position:"relative",zIndex:2,color:"#fff",p:3,display:"flex",flexDirection:"column",alignItems:"center"},children:[t.jsx(he,{sx:{color:"#fff",mb:2}}),t.jsx(O,{variant:"h6",children:W[V]})]})}),t.jsxs(F,{direction:"row",spacing:2,sx:{p:3,alignItems:"center",flexWrap:"wrap"},children:[t.jsx(R,{value:h,onChange:e=>z(e.target.value),placeholder:"Enter or paste docs URL",sx:{minWidth:280,flex:1},startAdornment:t.jsx(_,{position:"start",children:t.jsx(U,{})})}),t.jsx(w,{variant:"contained",onClick:ee,disabled:l,children:l?"Scraping...":"Scrape"}),t.jsx(w,{variant:"contained",color:"secondary",onClick:te,children:"Append to Local Storage"})]}),t.jsx(b,{}),t.jsxs(F,{direction:"row",spacing:2,sx:{p:3,flexWrap:"wrap",alignItems:"center"},children:[t.jsx(R,{value:u,onChange:e=>X(e.target.value),placeholder:"Search...",startAdornment:t.jsx(_,{position:"start",children:t.jsx(U,{})}),sx:{width:240}}),t.jsxs(B,{value:d,onChange:e=>$(e.target.value),displayEmpty:!0,sx:{width:200},children:[t.jsx(p,{value:"",children:"All Tables"}),le.map(e=>t.jsx(p,{value:e,children:e},e))]}),t.jsxs(B,{value:m,onChange:e=>H(e.target.value),displayEmpty:!0,sx:{width:200},children:[t.jsx(p,{value:"",children:"All Sources"}),ce.map(e=>t.jsx(p,{value:e,children:e},e))]}),t.jsx(J,{control:t.jsx(ge,{checked:x,onChange:e=>Y(e.target.checked)}),label:"Missing Description"}),t.jsx(w,{variant:"outlined",startIcon:t.jsx(Se,{}),onClick:ae,children:"Columns"}),t.jsx(fe,{anchorEl:P,open:!!P,onClose:se,children:t.jsx(we,{sx:{p:2},children:q.map(e=>t.jsx(J,{control:t.jsx(xe,{checked:f.includes(e),onChange:()=>ne(e)}),label:e},e))})})]}),t.jsx(b,{}),N&&t.jsx(O,{color:"error",sx:{p:2},children:N}),t.jsx(A,{sx:{overflowX:"auto",filter:l?"blur(2px)":"none",transition:"filter 0.2s ease"},children:t.jsx(je,{columns:de,rows:ue})}),t.jsx(b,{}),t.jsx(be,{component:"div",count:ie,page:k,onPageChange:re,rowsPerPage:j,onRowsPerPageChange:oe,rowsPerPageOptions:[5,10,25]})]})})}export{Me as T};
