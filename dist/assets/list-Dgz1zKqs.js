import{r as i,v as m,E as me,bA as Tt,bB as At,bC as Qt,bD as Ot,a8 as It,j as e,B as _,W as _t,T as j,F as Ae,S as T,I as Ee,aL as $t,b0 as Ye,bE as Pe,p as Xe,bF as d,bg as ee,x as qt,bm as kt,bn as Ht,an as Mt,b as A,D as se,ai as _e,bG as $e,M as et,t as te,aZ as Ft,bo as Z,ak as ce,al as ye,am as Te,bH as Se,K as Qe,o as Nt,bj as Lt,ax as Rt,ay as Dt,bI as Gt,bq as Ut,bs as qe,bt as le,H as Bt,a as Zt,a0 as Ce,aO as Wt,be as ke,bJ as zt,bK as Vt,bL as Jt,bM as Kt,L as Yt,y as Xt,A as es}from"./index-C5-7V04H.js";import{R as ts}from"./DownloadSimple-CS5SEKJi.js";import{w as ss}from"./UploadSimple-DTTZRe3K.js";import{D as ns}from"./data-table-XenAvZ69.js";import{P as as}from"./PencilSimple-D7AjZ8DX.js";import{w as rs}from"./PencilSimple-Cw3iL1ZK.js";import{P as os,a as X}from"./property-list-B20WaXhW.js";import{C as ne}from"./Card-D72Z6VP3.js";import{u as is,C as we,t as ls,z as ue}from"./index-DvGAAjB3.js";import{O as H}from"./option-BD2v2nDd.js";import{C as He}from"./CardContent-XBeE-BbS.js";import{C as cs}from"./CardActions-BqO0UwMI.js";import{T as ds}from"./TablePagination-CjbpsP_k.js";import{g as us}from"./getGitHubStoredConfig-Cg4sBu5t.js";import{L as ps}from"./LinearProgress-CTIsyjhu.js";import"./TableHead-BnjFcU27.js";import"./PencilSimple-DN8YatLk.js";var ms=Object.defineProperty,hs=Object.defineProperties,gs=Object.getOwnPropertyDescriptors,Me=Object.getOwnPropertySymbols,fs=Object.prototype.hasOwnProperty,xs=Object.prototype.propertyIsEnumerable,Fe=(s,t,n)=>t in s?ms(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n,bs=(s,t)=>{for(var n in t||(t={}))fs.call(t,n)&&Fe(s,n,t[n]);if(Me)for(var n of Me(t))xs.call(t,n)&&Fe(s,n,t[n]);return s},js=(s,t)=>hs(s,gs(t));const tt=i.forwardRef((s,t)=>m.createElement(me,js(bs({ref:t},s),{weights:Tt})));tt.displayName="CheckCircle";var vs=Object.defineProperty,ys=Object.defineProperties,Ss=Object.getOwnPropertyDescriptors,Ne=Object.getOwnPropertySymbols,Cs=Object.prototype.hasOwnProperty,ws=Object.prototype.propertyIsEnumerable,Le=(s,t,n)=>t in s?vs(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n,Es=(s,t)=>{for(var n in t||(t={}))Cs.call(t,n)&&Le(s,n,t[n]);if(Ne)for(var n of Ne(t))ws.call(t,n)&&Le(s,n,t[n]);return s},Ps=(s,t)=>ys(s,Ss(t));const st=i.forwardRef((s,t)=>m.createElement(me,Ps(Es({ref:t},s),{weights:At})));st.displayName="GithubLogo";const Ts=new Map([["bold",m.createElement(m.Fragment,null,m.createElement("path",{d:"M180,128a12,12,0,0,1-12,12H88a12,12,0,0,1,0-24h80A12,12,0,0,1,180,128Zm56,0A108,108,0,1,1,128,20,108.12,108.12,0,0,1,236,128Zm-24,0a84,84,0,1,0-84,84A84.09,84.09,0,0,0,212,128Z"}))],["duotone",m.createElement(m.Fragment,null,m.createElement("path",{d:"M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z",opacity:"0.2"}),m.createElement("path",{d:"M176,128a8,8,0,0,1-8,8H88a8,8,0,0,1,0-16h80A8,8,0,0,1,176,128Zm56,0A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"}))],["fill",m.createElement(m.Fragment,null,m.createElement("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm40,112H88a8,8,0,0,1,0-16h80a8,8,0,0,1,0,16Z"}))],["light",m.createElement(m.Fragment,null,m.createElement("path",{d:"M174,128a6,6,0,0,1-6,6H88a6,6,0,0,1,0-12h80A6,6,0,0,1,174,128Zm56,0A102,102,0,1,1,128,26,102.12,102.12,0,0,1,230,128Zm-12,0a90,90,0,1,0-90,90A90.1,90.1,0,0,0,218,128Z"}))],["regular",m.createElement(m.Fragment,null,m.createElement("path",{d:"M176,128a8,8,0,0,1-8,8H88a8,8,0,0,1,0-16h80A8,8,0,0,1,176,128Zm56,0A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"}))],["thin",m.createElement(m.Fragment,null,m.createElement("path",{d:"M172,128a4,4,0,0,1-4,4H88a4,4,0,0,1,0-8h80A4,4,0,0,1,172,128Zm56,0A100,100,0,1,1,128,28,100.11,100.11,0,0,1,228,128Zm-8,0a92,92,0,1,0-92,92A92.1,92.1,0,0,0,220,128Z"}))]]);var As=Object.defineProperty,Qs=Object.defineProperties,Os=Object.getOwnPropertyDescriptors,Re=Object.getOwnPropertySymbols,Is=Object.prototype.hasOwnProperty,_s=Object.prototype.propertyIsEnumerable,De=(s,t,n)=>t in s?As(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n,$s=(s,t)=>{for(var n in t||(t={}))Is.call(t,n)&&De(s,n,t[n]);if(Re)for(var n of Re(t))_s.call(t,n)&&De(s,n,t[n]);return s},qs=(s,t)=>Qs(s,Os(t));const nt=i.forwardRef((s,t)=>m.createElement(me,qs($s({ref:t},s),{weights:Ts})));nt.displayName="MinusCircle";var ks=Object.defineProperty,Hs=Object.defineProperties,Ms=Object.getOwnPropertyDescriptors,Ge=Object.getOwnPropertySymbols,Fs=Object.prototype.hasOwnProperty,Ns=Object.prototype.propertyIsEnumerable,Ue=(s,t,n)=>t in s?ks(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n,Ls=(s,t)=>{for(var n in t||(t={}))Fs.call(t,n)&&Ue(s,n,t[n]);if(Ge)for(var n of Ge(t))Ns.call(t,n)&&Ue(s,n,t[n]);return s},Rs=(s,t)=>Hs(s,Ms(t));const at=i.forwardRef((s,t)=>m.createElement(me,Rs(Ls({ref:t},s),{weights:Qt})));at.displayName="PlusCircle";const Ds=new Map([["bold",m.createElement(m.Fragment,null,m.createElement("path",{d:"M40,92H70.06a36,36,0,0,0,67.88,0H216a12,12,0,0,0,0-24H137.94a36,36,0,0,0-67.88,0H40a12,12,0,0,0,0,24Zm64-24A12,12,0,1,1,92,80,12,12,0,0,1,104,68Zm112,96H201.94a36,36,0,0,0-67.88,0H40a12,12,0,0,0,0,24h94.06a36,36,0,0,0,67.88,0H216a12,12,0,0,0,0-24Zm-48,24a12,12,0,1,1,12-12A12,12,0,0,1,168,188Z"}))],["duotone",m.createElement(m.Fragment,null,m.createElement("path",{d:"M128,80a24,24,0,1,1-24-24A24,24,0,0,1,128,80Zm40,72a24,24,0,1,0,24,24A24,24,0,0,0,168,152Z",opacity:"0.2"}),m.createElement("path",{d:"M40,88H73a32,32,0,0,0,62,0h81a8,8,0,0,0,0-16H135a32,32,0,0,0-62,0H40a8,8,0,0,0,0,16Zm64-24A16,16,0,1,1,88,80,16,16,0,0,1,104,64ZM216,168H199a32,32,0,0,0-62,0H40a8,8,0,0,0,0,16h97a32,32,0,0,0,62,0h17a8,8,0,0,0,0-16Zm-48,24a16,16,0,1,1,16-16A16,16,0,0,1,168,192Z"}))],["fill",m.createElement(m.Fragment,null,m.createElement("path",{d:"M32,80a8,8,0,0,1,8-8H77.17a28,28,0,0,1,53.66,0H216a8,8,0,0,1,0,16H130.83a28,28,0,0,1-53.66,0H40A8,8,0,0,1,32,80Zm184,88H194.83a28,28,0,0,0-53.66,0H40a8,8,0,0,0,0,16H141.17a28,28,0,0,0,53.66,0H216a8,8,0,0,0,0-16Z"}))],["light",m.createElement(m.Fragment,null,m.createElement("path",{d:"M40,86H74.6a30,30,0,0,0,58.8,0H216a6,6,0,0,0,0-12H133.4a30,30,0,0,0-58.8,0H40a6,6,0,0,0,0,12Zm64-24A18,18,0,1,1,86,80,18,18,0,0,1,104,62ZM216,170H197.4a30,30,0,0,0-58.8,0H40a6,6,0,0,0,0,12h98.6a30,30,0,0,0,58.8,0H216a6,6,0,0,0,0-12Zm-48,24a18,18,0,1,1,18-18A18,18,0,0,1,168,194Z"}))],["regular",m.createElement(m.Fragment,null,m.createElement("path",{d:"M40,88H73a32,32,0,0,0,62,0h81a8,8,0,0,0,0-16H135a32,32,0,0,0-62,0H40a8,8,0,0,0,0,16Zm64-24A16,16,0,1,1,88,80,16,16,0,0,1,104,64ZM216,168H199a32,32,0,0,0-62,0H40a8,8,0,0,0,0,16h97a32,32,0,0,0,62,0h17a8,8,0,0,0,0-16Zm-48,24a16,16,0,1,1,16-16A16,16,0,0,1,168,192Z"}))],["thin",m.createElement(m.Fragment,null,m.createElement("path",{d:"M40,84H76.29a28,28,0,0,0,55.42,0H216a4,4,0,0,0,0-8H131.71a28,28,0,0,0-55.42,0H40a4,4,0,0,0,0,8Zm64-24A20,20,0,1,1,84,80,20,20,0,0,1,104,60ZM216,172H195.71a28,28,0,0,0-55.42,0H40a4,4,0,0,0,0,8H140.29a28,28,0,0,0,55.42,0H216a4,4,0,0,0,0-8Zm-48,24a20,20,0,1,1,20-20A20,20,0,0,1,168,196Z"}))]]);var Gs=Object.defineProperty,Us=Object.defineProperties,Bs=Object.getOwnPropertyDescriptors,Be=Object.getOwnPropertySymbols,Zs=Object.prototype.hasOwnProperty,Ws=Object.prototype.propertyIsEnumerable,Ze=(s,t,n)=>t in s?Gs(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n,zs=(s,t)=>{for(var n in t||(t={}))Zs.call(t,n)&&Ze(s,n,t[n]);if(Be)for(var n of Be(t))Ws.call(t,n)&&Ze(s,n,t[n]);return s},Vs=(s,t)=>Us(s,Bs(t));const rt=i.forwardRef((s,t)=>m.createElement(Ot,Vs(zs({ref:t},s),{weights:Ds})));rt.displayName="SlidersHorizontal";const Js=It(e.jsx("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");function Ks({rows:s=[],loading:t=!1,onPreviewQuery:n,onEditQueryWithForm:u}){const v=i.useMemo(()=>[{name:"Question",width:"35%",formatter:l=>e.jsxs(_,{sx:{whiteSpace:"normal",wordBreak:"break-word"},children:[e.jsx(_t,{color:"text.primary",onClick:()=>n==null?void 0:n(l.id),sx:{cursor:"pointer"},variant:"subtitle2",children:l.question||"question"}),e.jsx(j,{color:"text.secondary",variant:"body2",children:l.statementType||"N/A"})]})},{name:"SQL Query",width:"30%",formatter:l=>{if(!l.sql)return e.jsx(j,{variant:"body2",color:"text.secondary",children:"No SQL"});const b=l.sql.length>60?l.sql.slice(0,60)+"...":l.sql;return e.jsx(j,{variant:"body2",sx:{whiteSpace:"pre-wrap",wordBreak:"break-all"},children:b})}},{name:"Last Used",width:"15%",formatter:l=>{var b;return((b=l.createdAt)==null?void 0:b.toLocaleDateString())??"N/A"}},{name:"Count",width:"10%",align:"center",formatter(l){return e.jsx(Ae,{label:l.count,size:"small",variant:"outlined"})}},{name:"Actions",width:"10%",hideName:!0,align:"right",formatter:l=>e.jsxs(T,{direction:"row",spacing:.5,justifyContent:"flex-end",children:[n&&e.jsx(Ee,{onClick:()=>n(l.id),title:"View / Edit Details",children:e.jsx(rt,{size:20})}),u&&e.jsx(Ee,{onClick:()=>u(l),title:"Edit with Form",children:e.jsx(as,{size:20})})]})}],[n,u]);return t?e.jsx(_,{sx:{p:3,display:"flex",justifyContent:"center"},children:e.jsx($t,{})}):e.jsxs(e.Fragment,{children:[e.jsx(ns,{columns:v,rows:s}),s.length===0&&!t&&e.jsx(_,{sx:{p:3},children:e.jsx(j,{color:"text.secondary",sx:{textAlign:"center"},variant:"body2",children:"No queries found"})})]})}function Ys(s){const t=/(Syntax error:.*?at \[\d+:\d+\]|Unrecognized name:.*?at \[\d+:\d+\])/i,n=s.match(t);return n?n[0].replace(/\s+at\s+\[\d+:\d+\]/i,"").trim():s}function We(s){s.languages.registerDocumentFormattingEditProvider("sql",{provideDocumentFormattingEdits(t){const n=t.getValue(),u=Pe(n,{language:"bigquery",tabWidth:2,keywordCase:"upper"});return[{range:t.getFullModelRange(),text:u}]}})}function Xs({open:s,query:t,onClose:n,onSave:u}){const v=Ye(),l=!(t!=null&&t.id),[b,y]=i.useState(l),[g,S]=i.useState(""),[O,h]=i.useState(""),[w,Q]=i.useState(""),[L,f]=i.useState("idle"),[R,$]=i.useState(""),[M,W]=i.useState(""),[G,z]=i.useState(null),U=!!G,c=x=>z(x.currentTarget),de=()=>z(null);function q(x){const B="https://lookerstudio.google.com/reporting/create",J="edit",ae="bigQuery",re="bigquery-public-data",oe="foreign-connect-48db5",ge=encodeURIComponent(x),fe=`${B}?c.mode=${J}&ds.connector=${ae}&ds.type=CUSTOM_QUERY&ds.projectId=${re}&ds.sql=${ge}&ds.billingProjectId=${oe}`;window.open(fe,"_blank")}i.useEffect(()=>{if(t){const x=t.sql??"",B=Pe(x,{language:"bigquery",tabWidth:2,keywordCase:"upper"});S(t.question??""),h(t.statementType??"N/A"),Q(B),y(l)}else S(""),h("N/A"),Q(`SELECT 
	*
FROM 
	\`your_project.your_dataset.your_table\`
LIMIT 100;`),y(!0);f("idle"),$(""),W("")},[t,l,s]);const k=i.useCallback(()=>{n?n():v(Xe.dashboard.products.list)},[v,n]),I=i.useCallback(()=>{const x={id:(t==null?void 0:t.id)||`temp-${Date.now()}`,question:g.trim(),sql:w,statementType:O.trim()||"N/A",count:(t==null?void 0:t.count)??0,createdAt:(t==null?void 0:t.createdAt)??new Date,avgExecutionTime:t==null?void 0:t.avgExecutionTime,avgTotalBytesProcessed:t==null?void 0:t.avgTotalBytesProcessed};if(!x.question){d.error("Question cannot be empty.");return}if(!x.sql.trim()){d.error("SQL query cannot be empty.");return}u(x,l),l?d.success(`Created new query: ${g}`):d.success(`Updated query: ${g}`),k()},[l,t,g,w,O,u,k]),K=i.useCallback(()=>{!l&&t?(S(t.question??""),h(t.statementType??"N/A"),Q(Pe(t.sql??"",{language:"bigquery",tabWidth:2,keywordCase:"upper"})),y(!1)):k()},[l,t,k]),V=i.useCallback(async()=>{try{f("idle"),$(""),W("");const x=await ee("http://localhost:8000/api/dry_run",{method:"POST",body:JSON.stringify({query:w})});if(!x.ok){const J=await x.json(),ae=(J==null?void 0:J.message)||"Error testing query",re=Ys(ae);throw new Error(re)}const B=await x.json();$(B.formatted_bytes_processed),f("success"),d.success(B.message)}catch(x){console.error("Dry run failed:",x),f("error"),W(x.message),d.error(x.message||"Error testing query")}},[w]);if(!s)return null;const D=(t==null?void 0:t.id)??"NO-ID",C=(t==null?void 0:t.count)??0,F=t!=null&&t.createdAt?qt(t.createdAt).format("MMMM D, YYYY hh:mm A"):"N/A",he=(t==null?void 0:t.avgExecutionTime)!=null?`${t.avgExecutionTime} ms`:"N/A",N=(t==null?void 0:t.avgTotalBytesProcessed)!=null?`${t.avgTotalBytesProcessed.toFixed(2)} bytes`:"N/A";return e.jsx(kt,{open:s,onClose:k,maxWidth:"sm",sx:{"& .MuiDialog-container":{justifyContent:"flex-end"},"& .MuiDialog-paper":{height:"100%",width:"100%"}},children:e.jsxs(Ht,{sx:{display:"flex",flexDirection:"column",gap:2,minHeight:0},children:[e.jsxs(T,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(j,{variant:"h6",children:l?"Add Query":`Edit Query ${D}`}),e.jsx(Ee,{onClick:k,children:e.jsx(Mt,{})})]}),e.jsxs(T,{spacing:3,sx:{flex:"1 1 auto",overflowY:"auto"},children:[e.jsxs(T,{spacing:3,children:[e.jsxs(T,{direction:"row",spacing:3,sx:{alignItems:"center",justifyContent:"space-between"},children:[e.jsx(j,{variant:"h6",children:"Details"}),!l&&!b?e.jsx(A,{color:"secondary",startIcon:e.jsx(rs,{}),onClick:()=>y(!0),children:"Edit"}):null,b&&e.jsxs(T,{direction:"row",spacing:2,children:[e.jsx(A,{variant:"contained",onClick:I,children:"Save"}),e.jsx(A,{color:"secondary",onClick:K,children:"Cancel"})]})]}),e.jsx(ne,{sx:{borderRadius:1},variant:"outlined",children:b?e.jsxs(_,{sx:{p:2,display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(j,{variant:"body2",color:"text.secondary",children:["ID: ",D]}),e.jsx(_e,{label:"Question",value:g,onChange:x=>S(x.target.value),fullWidth:!0}),e.jsx(_e,{label:"Statement Type",value:O,onChange:x=>h(x.target.value),fullWidth:!0}),e.jsxs(j,{variant:"body2",color:"text.secondary",children:["Created: ",F]}),e.jsxs(j,{variant:"body2",color:"text.secondary",children:["Count: ",C]})]}):e.jsxs(os,{divider:e.jsx(se,{}),sx:{"--PropertyItem-padding":"12px 24px"},children:[e.jsx(X,{name:"Question",value:g||"N/A"}),e.jsx(X,{name:"Statement Type",value:O||"N/A"}),e.jsx(X,{name:"Created at",value:F}),e.jsx(X,{name:"Count",value:e.jsx(Ae,{icon:e.jsx(tt,{color:"var(--mui-palette-success-main)",weight:"fill"}),label:C,size:"small",variant:"outlined"})}),e.jsx(X,{name:"Avg Execution Time",value:he}),e.jsx(X,{name:"Avg Bytes Processed",value:N})]})})]}),e.jsxs(T,{spacing:3,children:[e.jsx(j,{variant:"h6",children:"Full Query"}),e.jsx(ne,{sx:{borderRadius:1},variant:"outlined",children:b?e.jsxs(_,{sx:{p:2,display:"flex",flexDirection:"column",gap:2},children:[e.jsx($e,{height:"200px",defaultLanguage:"sql",value:w,beforeMount:We,onChange:x=>{typeof x=="string"&&(Q(x),f("idle"),W(""))},options:{minimap:{enabled:!1},wordWrap:"on"}}),e.jsx(A,{variant:"contained",color:L==="success"?"success":"primary",onClick:V,children:L==="success"?`Query Valid - ${R}`:"Validate Query"}),L==="error"&&M&&e.jsx(j,{color:"error",variant:"body2",children:M})]}):e.jsx(_,{sx:{p:2},children:w?e.jsxs(e.Fragment,{children:[e.jsx($e,{height:"200px",defaultLanguage:"sql",value:w,beforeMount:We,options:{readOnly:!0,minimap:{enabled:!1},wordWrap:"on"}}),e.jsx(A,{variant:"contained",onClick:c,sx:{mt:2},children:"Open Query"}),e.jsxs(et,{anchorEl:G,open:U,onClose:de,children:[e.jsx(te,{onClick:()=>{q(w),de()},children:"Looker Studio"}),e.jsx(te,{disabled:!0,children:"Tableau (coming soon)"}),e.jsx(te,{disabled:!0,children:"Power BI (coming soon)"})]})]}):e.jsx(j,{variant:"body2",color:"text.secondary",children:"No SQL"})})})]})]})]})})}const en=ue.object({question:ue.string().min(1,"Question is required").max(1e3),statementType:ue.string().max(255).optional(),sql:ue.string().max(5e3).optional()});function ze(s){return{question:s.question??"",statementType:s.statementType??"",sql:s.sql??""}}function tn({query:s,onSave:t,onCancel:n}){const{control:u,handleSubmit:v,formState:{errors:l},reset:b}=is({defaultValues:ze(s),resolver:ls(en)});i.useEffect(()=>{b(ze(s))},[s,b]);const y=i.useCallback(async g=>{try{const S={...s,question:g.question,statementType:g.statementType||s.statementType||"N/A",sql:g.sql||s.sql||""};t(S),d.success("Query updated!")}catch(S){Ft.error(S),d.error("Something went wrong!")}},[s,t]);return e.jsx("form",{onSubmit:v(y),children:e.jsxs(Z,{container:!0,spacing:4,children:[e.jsx(Z,{item:!0,xs:12,md:8,children:e.jsxs(ne,{children:[e.jsx(He,{children:e.jsxs(T,{spacing:4,divider:e.jsx(se,{}),children:[e.jsxs(T,{spacing:2,children:[e.jsxs(j,{variant:"h6",children:["Edit Query: ",s.id]})," ",e.jsxs(Z,{container:!0,spacing:3,children:[e.jsx(Z,{item:!0,xs:12,children:e.jsx(we,{control:u,name:"question",render:({field:g})=>e.jsxs(ce,{error:!!l.question,fullWidth:!0,children:[e.jsx(ye,{required:!0,children:"Question"}),e.jsx(Te,{...g,label:"Question"}),l.question&&e.jsx(Se,{children:l.question.message})]})})}),e.jsx(Z,{item:!0,xs:12,children:e.jsx(we,{control:u,name:"statementType",render:({field:g})=>e.jsxs(ce,{error:!!l.statementType,fullWidth:!0,children:[e.jsx(ye,{children:"Statement Type"}),e.jsxs(Qe,{...g,label:"Statement Type",defaultValue:s.statementType||"",children:[e.jsx(H,{value:"",children:e.jsx("em",{children:"None"})})," ",e.jsx(H,{value:"SELECT",children:"SELECT"}),e.jsx(H,{value:"CREATE",children:"CREATE"}),e.jsx(H,{value:"UPDATE",children:"UPDATE"}),e.jsx(H,{value:"DELETE",children:"DELETE"}),e.jsx(H,{value:"INSERT",children:"INSERT"}),e.jsx(H,{value:"MERGE",children:"MERGE"}),e.jsx(H,{value:"OTHER",children:"OTHER"})]}),l.statementType&&e.jsx(Se,{children:l.statementType.message})]})})})]})]}),e.jsxs(T,{spacing:2,children:[e.jsx(j,{variant:"h6",children:"SQL Query"}),e.jsx(Z,{container:!0,spacing:3,children:e.jsx(Z,{item:!0,xs:12,children:e.jsx(we,{control:u,name:"sql",render:({field:g})=>e.jsxs(ce,{error:!!l.sql,fullWidth:!0,children:[e.jsx(ye,{children:"SQL"}),e.jsx(Te,{...g,label:"SQL",multiline:!0,minRows:4,placeholder:"Type or edit your SQL here..."}),l.sql&&e.jsx(Se,{children:l.sql.message})]})})})})]})]})}),e.jsxs(cs,{sx:{justifyContent:"flex-end"},children:[e.jsx(A,{onClick:n,color:"secondary",children:"Cancel"}),e.jsx(A,{variant:"contained",type:"submit",children:"Save Changes"})]})]})}),e.jsx(Z,{item:!0,xs:12,md:4,children:e.jsx(ne,{children:e.jsxs(He,{children:[e.jsx(j,{variant:"h6",children:"Original Details"}),e.jsx(j,{variant:"subtitle1",color:"text.primary",sx:{mt:1,wordBreak:"break-word"},children:s.question}),e.jsxs(j,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["ID: ",s.id]}),e.jsxs(j,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["Statement Type: ",s.statementType||"N/A"]}),e.jsx(se,{sx:{my:2}}),e.jsx(j,{variant:"body2",color:"text.primary",sx:{whiteSpace:"pre-wrap",wordBreak:"break-all"},children:s.sql||"No SQL found"})]})})})]})})}function Ve(...s){}const ot=i.createContext({anchorEl:null,onApply:Ve,onClose:Ve,open:!1,value:void 0});function it(){const s=i.useContext(ot);if(!s)throw new Error("useFilterContext must be used within a FilterProvider");return s}function Je({displayValue:s,label:t,onFilterApply:n,onFilterDelete:u,popover:v,value:l}){const{anchorRef:b,handleOpen:y,handleClose:g,open:S}=Nt(),O=i.useCallback(h=>{g(),n==null||n(h)},[g,n]);return e.jsxs(ot.Provider,{value:{anchorEl:b.current,onApply:O,onClose:g,open:S,value:l},children:[e.jsx(A,{color:"secondary",onClick:y,ref:b,startIcon:l?e.jsx(_,{onClick:h=>{h.stopPropagation(),h.preventDefault(),u==null||u()},onKeyUp:h=>{h.stopPropagation(),h.preventDefault(),(h.key==="Enter"||h.key===" ")&&(u==null||u())},role:"button",sx:{display:"flex"},tabIndex:0,children:e.jsx(nt,{})}):e.jsx(at,{}),variant:"outlined",children:e.jsxs("span",{children:[t,s?e.jsxs(i.Fragment,{children:[":"," ",e.jsx(_,{component:"span",sx:{color:"var(--mui-palette-primary-main)"},children:s})]}):null]})}),v]})}function lt({children:s,title:t,onClose:n,anchorEl:u,open:v}){return e.jsx(Lt,{anchorEl:u,anchorOrigin:{horizontal:"left",vertical:"bottom"},onClose:n,open:!!(u&&v),sx:{"& .MuiPopover-paper":{mt:"4px",width:"280px"}},children:e.jsxs(T,{spacing:2,sx:{p:2},children:[e.jsx(j,{variant:"subtitle2",children:t}),s]})})}const sn=[{label:"All",value:"",count:5},{label:"Published",value:"published",count:3},{label:"Draft",value:"draft",count:2}];function nn({filters:s={},sortDir:t="desc",statementTypes:n=[]}){const{statementType:u,sku:v,status:l,question:b}=s,y=Ye(),g=i.useCallback((f,R)=>{const $=new URLSearchParams;R==="asc"&&$.set("sortDir",R),f.status&&$.set("status",f.status),f.sku&&$.set("sku",f.sku),f.statementType&&$.set("statementType",f.statementType),f.question&&$.set("question",f.question),y(`${Xe.dashboard.products.list}?${$.toString()}`)},[y]),S=i.useCallback(()=>{g({},t)},[g,t]),O=i.useCallback((f,R)=>{g({...s,status:R},t)},[g,s,t]),h=i.useCallback(f=>{g({...s,statementType:f},t)},[g,s,t]);i.useCallback(f=>{g({...s,sku:f},t)},[g,s,t]);const w=i.useCallback(f=>{g({...s,question:f},t)},[g,s,t]),Q=i.useCallback(f=>{g(s,f.target.value)},[g,s]),L=!!(l||u||v||b);return e.jsxs("div",{children:[e.jsx(Rt,{onChange:O,sx:{px:3},value:l??"",variant:"scrollable",children:sn.map(f=>e.jsx(Dt,{icon:e.jsx(Ae,{label:f.count,size:"small",variant:"soft"}),iconPosition:"end",label:f.label,sx:{minHeight:"auto"},tabIndex:0,value:f.value},f.value))}),e.jsx(se,{}),e.jsxs(T,{direction:"row",spacing:2,sx:{alignItems:"center",flexWrap:"wrap",p:2},children:[e.jsxs(T,{direction:"row",spacing:2,sx:{alignItems:"center",flex:"1 1 auto",flexWrap:"wrap"},children:[e.jsx(Je,{displayValue:u||void 0,label:"SQL Statement Type",onFilterApply:f=>{h(f)},onFilterDelete:()=>{h()},popover:e.jsx(an,{statementTypes:n}),value:u||void 0}),e.jsx(Je,{displayValue:b||void 0,label:"Question",onFilterApply:f=>{w(f)},onFilterDelete:()=>{w()},popover:e.jsx(rn,{}),value:b||void 0}),L?e.jsx(A,{onClick:S,children:"Clear filters"}):null]}),e.jsxs(Qe,{name:"sort",onChange:Q,sx:{maxWidth:"100%",width:"120px"},value:t,children:[e.jsx(H,{value:"desc",children:"Newest"}),e.jsx(H,{value:"asc",children:"Oldest"})]})]})]})}function an(s){const{statementTypes:t}=s,{anchorEl:n,onApply:u,onClose:v,open:l,value:b}=it(),[y,g]=i.useState("");return i.useEffect(()=>{g(b??"")},[b]),e.jsxs(lt,{anchorEl:n,onClose:v,open:l,title:"Filter by Statement Type",children:[e.jsx(ce,{children:e.jsxs(Qe,{onChange:S=>{g(S.target.value)},value:y,children:[e.jsx(H,{value:"",children:"All Statement Types"}),t.map(S=>e.jsx(H,{value:S,children:S},S))]})}),e.jsx(A,{onClick:()=>{u(y)},variant:"contained",children:"Apply"})]})}function rn(){const{anchorEl:s,onApply:t,onClose:n,open:u,value:v}=it(),[l,b]=i.useState("");return i.useEffect(()=>{b(v??"")},[v]),e.jsxs(lt,{anchorEl:s,onClose:n,open:u,title:"Filter by Question",children:[e.jsx(ce,{children:e.jsx(Te,{placeholder:"Type a question keyword...",onChange:y=>{b(y.target.value)},onKeyUp:y=>{y.key==="Enter"&&t(l)},value:l})}),e.jsx(A,{onClick:()=>{t(l)},variant:"contained",children:"Apply"})]})}function on({count:s,page:t,rowsPerPage:n,onChangePage:u,onChangeRowsPerPage:v}){return e.jsx(ds,{component:"div",count:s,page:t,rowsPerPage:n,onPageChange:u,onRowsPerPageChange:v,rowsPerPageOptions:[5,10,25]})}const ln={title:`Queries | ${Zt.name}`};function pe(s){return s.map((t,n)=>({id:t.id||`API-Q-${Date.now()}-${n}`,question:t.question,sql:t.query,count:t.count||0,statementType:t.statement_type||"N/A",createdAt:t.creation_time?new Date(t.creation_time):new Date,avgExecutionTime:t.avg_execution_time||null,avgTotalBytesProcessed:t.avg_total_bytes_processed||null}))}const Ke="appSavedQueries";function An(){const{selectedProject:s}=Gt(),[t,n]=Ut(),[u,v]=i.useState(null);i.useEffect(()=>{v({gcp_project_id:"my-uscis-project",dataset_id:"rag_orchestrator_dataset",region:"us",vertex_connection_name:"us.vertex-ai",embedding_model_endpoint:"text_embedding_model"})},[]);const l=t.get("statementType")||void 0,b=t.get("question")||void 0,y=t.get("sku")||void 0,g=t.get("sortDir")||void 0,S=Number.parseInt(t.get("page")||"0",10),O=Number.parseInt(t.get("rowsPerPage")||"5",10),[h,w]=i.useState("demo queries"),[Q,L]=i.useState(()=>{try{const a=localStorage.getItem(Ke);return a?pe(JSON.parse(a)):[]}catch(a){return console.error("Error loading saved queries from localStorage:",a),d.error("Could not load saved queries."),[]}});i.useEffect(()=>{try{localStorage.setItem(Ke,JSON.stringify(Q.map(a=>{var r;return{...a,createdAt:((r=a.createdAt)==null?void 0:r.toISOString())??"N/A"}})))}catch(a){console.error("Error saving queries to localStorage:",a),d.error("Could not save queries to local storage.")}},[Q]);const[f,R]=i.useState(null),$=!!f,M=t.get("previewId")||void 0,[W,G]=i.useState(!1),[z,U]=i.useState(null),[c,de]=i.useState(null);i.useEffect(()=>{de(us())},[]);const[q,k]=i.useState(!1),[I,K]=i.useState({current:0,total:0}),[V,D]=i.useState({successes:0,failures:0,errorDetails:[]}),C=qe({queryKey:["apiExternalQueries",s],queryFn:async()=>{if(!s)return[];const a=`http://localhost:8000/api/${s}/queries`,r=await ee(a,{method:"GET"});if(!r.ok){const p=await r.json().catch(()=>({detail:`HTTP error ${r.status}`}));throw new Error(p.detail||`HTTP error fetching API queries: ${r.status}`)}const o=await r.json();return pe(o)},enabled:h==="api"}),F=qe({queryKey:["demoQueries"],queryFn:async()=>{const a=await fetch("/sample-queries.json");if(!a.ok)throw new Error(`HTTP error fetching demo queries: ${a.status}`);const r=await a.json();return pe(r)},enabled:h==="demo queries",staleTime:1/0});i.useEffect(()=>{h==="api"&&C.isSuccess&&C.data?(d.success("Queries fetched from API. Updating 'Saved' list."),L(C.data),w("saved"),n(a=>{const r=new URLSearchParams(a);return r.set("page","0"),r})):h==="api"&&C.isError&&d.error(`Failed to fetch from API: ${C.error.message}`)},[h,C.isSuccess,C.isError,C.data,C.error,n]);const he=le({mutationFn:async a=>{const r=await ee("http://localhost:8000/api/question-query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok){const o=await r.json().catch(()=>({detail:`HTTP error ${r.status}`}));throw new Error(o.detail||`Failed to process Q/Q pair: ${r.status}`)}return r.json()}}),N=le({mutationFn:async a=>{d.info("Fetching Q/Q pairs from GitHub...");const r=await ee("http://localhost:8000/api/git/qq/load",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok){const p=await r.json().catch(()=>({detail:`HTTP error ${r.status}`}));throw new Error(p.detail||`Failed to fetch Q/Q pairs from GitHub: ${r.status}`)}const o=await r.json();if(o&&Array.isArray(o.qq_data))return o.qq_data.map(P=>({id:P.id,question_text:P.question,sql_query_text:P.query}));throw new Error("Invalid data structure received: 'qq_data' array not found.")},onSuccess:async a=>{if(console.log("%c[ON_SUCCESS_START] Entered fetchQQFromGitHubMutation.onSuccess","color: blue; font-weight: bold;"),console.log("[ON_SUCCESS_START] Current apiConfig:",JSON.stringify(u,null,2)),console.log("[ON_SUCCESS_START] Fetched pairs (GitHubFetchedQueryPair[]) length:",a?a.length:"undefined/null"),a&&a.length>0&&console.log("[ON_SUCCESS_START] First fetched pair (GitHubFetchedQueryPair):",JSON.stringify(a[0],null,2)),!u){console.error("[ON_SUCCESS_EXIT] API configuration is missing! Halting iteration."),d.error("API configuration is missing. Cannot proceed with Q/Q pair uploads."),k(!1);return}if(console.log("[ON_SUCCESS_CHECK] apiConfig is present."),!a||a.length===0){console.warn("[ON_SUCCESS_EXIT] No Q/Q pairs in fetchedPairs array. Halting iteration."),d.info("No Q/Q pairs fetched from GitHub, or the file was empty."),k(!1),K({current:0,total:0});return}console.log(`[ON_SUCCESS_CHECK] fetchedPairs array contains ${a.length} items. Proceeding to iteration setup.`),d.success(`Successfully fetched ${a.length} Q/Q pairs from GitHub. Starting individual processing...`),K({current:0,total:a.length}),D({successes:0,failures:0,errorDetails:[]});const r={successes:0,failures:0,errorDetails:[]};console.log("%c[ITERATION_START] About to start iterating through fetchedPairs.","color: green; font-weight: bold;");for(let o=0;o<a.length;o++){console.log(`%c[LOOP] Iteration ${o+1} - BEGIN`,"color: orange;");const p=a[o];if(console.log(`[LOOP] Iteration ${o+1} - Assigned 'pair':`,JSON.stringify(p,null,2)),!p){console.error(`[LOOP] Iteration ${o+1} - 'pair' is undefined or null. Skipping.`),d.error(`Skipping item ${o+1} due to invalid data (item is null/undefined).`),r.failures++,D({...r});continue}if(typeof p.question_text!="string"){console.error(`[LOOP] Iteration ${o+1} - 'pair.question_text' is not a string. Pair:`,JSON.stringify(p)),d.error(`Skipping item ${o+1} due to missing or invalid question text.`),r.failures++,r.errorDetails.push({question:p.question_text||"N/A (invalid question_text)",error:"Missing or invalid question text",qq_id:p.id}),D({...r});continue}if(typeof p.sql_query_text!="string"){console.error(`[LOOP] Iteration ${o+1} - 'pair.sql_query_text' is not a string. Pair:`,JSON.stringify(p)),d.error(`Skipping item ${o+1} due to missing or invalid query text.`),r.failures++,r.errorDetails.push({question:p.question_text,error:"Missing or invalid query text",qq_id:p.id}),D({...r});continue}console.log(`[LOOP] Iteration ${o+1} - 'pair' and its core properties (question_text, sql_query_text) are valid.`),console.log(`[LOOP] Iteration ${o+1} - Attempting to setUploadProgress.`);try{K(E=>({...E,current:o+1}))}catch(E){console.error(`[LOOP] Iteration ${o+1} - Error during setUploadProgress:`,E.message,E)}console.log(`[LOOP] Iteration ${o+1} - setUploadProgress called.`),console.log(`[ITERATION_ITEM ${o+1}/${a.length}] Log before payload construction. Question: "${p.question_text.slice(0,30)}..."`);const P={config:u,question_text:p.question_text,sql_query_text:p.sql_query_text,qq_id:p.id||void 0};console.log(`[ITERATION_ITEM ${o+1}] Payload for single upload:`,JSON.stringify(P,null,2));try{d.info(`Processing Q/Q pair ${o+1}/${a.length}: "${p.question_text.slice(0,30)}..."`),console.log(`[ITERATION_ITEM ${o+1}] Calling uploadSingleQQPairMutation.mutateAsync()...`);const E=await he.mutateAsync(P);console.log(`[ITERATION_ITEM ${o+1}] Successfully processed. Result:`,JSON.stringify(E,null,2)),d.success(`Successfully processed "${p.question_text.slice(0,30)}..." (ID: ${E.qq_id})`),r.successes++}catch(E){console.error(`[ITERATION_ITEM ${o+1}] Error processing item: "${p.question_text.slice(0,30)}..."`,E.message,E),d.error(`Failed to process "${p.question_text.slice(0,30)}...": ${E.message}`),r.failures++,r.errorDetails.push({question:p.question_text,error:E.message,qq_id:P.qq_id})}D({...r}),console.log(`%c[LOOP] Iteration ${o+1} - END`,"color: orange;")}console.log("%c[ITERATION_END] Finished iterating through fetchedPairs.","color: green; font-weight: bold;"),k(!1),d.info("Finished processing all Q/Q pairs from GitHub."),r.failures>0?d.error(`Iterative processing completed with ${r.failures} failure(s) and ${r.successes} success(es).`):d.success(`All ${r.successes} Q/Q pairs processed successfully!`)},onError:a=>{console.error("[FETCH_ON_ERROR] Error during fetchQQFromGitHubMutation's async operations (onSuccess included):",a.message,a),d.error(`Critical error during GitHub Q/Q processing: ${a.message}`),k(!1)}}),x=le({mutationFn:async a=>{d.info("Fetching Q/Q pairs from GitHub to view/edit...");const r=await ee("http://localhost:8000/api/git/qq/load",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok){const p=await r.json().catch(()=>({detail:`HTTP error ${r.status}`}));throw new Error(p.detail||`Failed to fetch Q/Q pairs from GitHub: ${r.status}`)}const o=await r.json();if(o&&Array.isArray(o.qq_data))return o.qq_data.map(P=>({id:P.id,question_text:P.question,sql_query_text:P.query}));throw new Error("Invalid data structure from GitHub load: 'qq_data' array not found.")},onSuccess:a=>{if(d.dismiss(),!a||a.length===0){d.info("No Q/Q pairs found in GitHub file, or the file was empty. 'Saved' list remains unchanged.");return}d.success(`Successfully fetched ${a.length} Q/Q pairs from GitHub.`);const r=a.map(p=>({id:p.id,question:p.question_text,query:p.sql_query_text})),o=pe(r);L(o),w("saved"),d.success(`Loaded ${o.length} queries into 'Saved' list for review/editing.`),n(p=>{const P=new URLSearchParams(p);return P.set("page","0"),P},{replace:!0})},onError:a=>{d.dismiss(),d.error(`Failed to load Q/Q pairs into 'Saved' list: ${a.message}`)}}),B=async()=>{if(!c||!c.isConfigured||!c.repoUrl||!c.branch||!c.pat||!c.qqFileName){d.error("GitHub configuration (Repo URL, Branch, PAT, Q/Q Filename) is incomplete.");return}if(x.isPending){d.info("Already fetching from GitHub for 'Saved' list...");return}if(q||N.isPending){d.warning("A bulk processing operation is already in progress. Please wait for it to complete.");return}const a={git_config:{repo_url:c.repoUrl,branch:c.branch,github_pat:c.pat},target_file_name:c.qqFileName};x.mutate(a)},J=async()=>{if(!u){d.error("API (GCP/BigQuery) configuration is missing.");return}if(!c||!c.isConfigured||!c.repoUrl||!c.branch||!c.pat||!c.qqFileName){d.error("GitHub configuration (Repo URL, Branch, PAT, Q/Q Filename) is incomplete.");return}if(q||N.isPending){d.info("An upload process is already running.");return}d.info("Starting bulk Q/Q pair processing from GitHub..."),k(!0),K({current:0,total:0}),D({successes:0,failures:0,errorDetails:[]});const a={git_config:{repo_url:c.repoUrl,branch:c.branch,github_pat:c.pat},target_file_name:c.qqFileName};N.mutate(a)},ae=a=>R(a.currentTarget),re=()=>R(null),oe=a=>{U(null),G(!1),n(r=>{const o=new URLSearchParams(r);return o.set("page","0"),o.delete("previewId"),o}),w(a),R(null)},ge=i.useCallback(()=>{U(null),n(a=>{const r=new URLSearchParams(a);return r.delete("previewId"),r}),G(!0)},[n]),fe=i.useCallback(()=>G(!1),[]),ct=i.useCallback(a=>{U(null),G(!1),n(r=>{const o=new URLSearchParams(r);return o.set("previewId",a),o})},[n]),dt=i.useCallback(()=>{n(a=>{const r=new URLSearchParams(a);return r.delete("previewId"),r})},[n]),ut=i.useCallback(a=>{G(!1),n(r=>{const o=new URLSearchParams(r);return o.delete("previewId"),o}),U(a)},[n]),pt=i.useCallback(()=>U(null),[]),Y=i.useMemo(()=>z?[]:h==="saved"?Q:h==="demo queries"?F.data||[]:[],[h,Q,F.data,z]),mt=i.useMemo(()=>{if(!M)return;let a=Q.find(r=>r.id===M);return a||(h==="api"&&C.data?a=C.data.find(r=>r.id===M):h==="demo queries"&&F.data&&(a=F.data.find(r=>r.id===M)),a)},[M,Q,h,C.data,F.data]);i.useCallback(()=>{switch(h){case"api":{d.info("Re-fetching queries from API..."),C.refetch();break}case"demo queries":{F.refetch();break}case"saved":{d.info("Refreshing 'Saved' queries from API..."),w("api");break}}},[h,C,F]);const Oe=i.useMemo(()=>dn(Y,{statementType:l,question:b,sku:y}),[Y,l,b,y]),xe=i.useMemo(()=>cn(Oe,g),[Oe,g]),ht=i.useMemo(()=>{const a=S*O;return xe.slice(a,a+O)},[xe,S,O]),gt=i.useCallback((a,r)=>{n(o=>{const p=new URLSearchParams(o);return p.set("page",String(r)),p})},[n]),ft=i.useCallback(a=>{n(r=>{const o=new URLSearchParams(r);return o.set("rowsPerPage",a.target.value),o.set("page","0"),o})},[n]),xt=i.useCallback((a,r)=>{L(o=>r?[...o,a]:o.map(p=>p.id===a.id?a:p)),h!=="saved"&&w("saved"),n(o=>{const p=new URLSearchParams(o);return p.set("page","0"),p})},[h,n]),bt=i.useCallback(a=>{L(r=>r.map(o=>o.id===a.id?a:o)),h!=="saved"&&w("saved"),n(r=>{const o=new URLSearchParams(r);return o.set("page","0"),o}),U(null)},[h,n]),jt=le({mutationFn:async a=>(console.log("Initializing resources with config:",a),{message:"Initialization called"}),onSuccess:()=>{d.success("Backend resources initialization completed!")},onError:a=>{d.error(`Backend resources initialization failed: ${a.message}`)}}),ie=le({mutationFn:async a=>{const r=await ee("http://localhost:8000/api/git/qq/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok){const o=await r.json().catch(()=>({detail:`HTTP error ${r.status}`}));throw new Error(o.detail||`HTTP error ${r.status}`)}return r.json()},onSuccess:a=>{a.success?d.success(`Q/Q saved to GitHub! File: ${a.file_path}`):d.error(`Failed to save to GitHub: ${a.message||a.error}`)},onError:a=>{d.error(`Error saving to GitHub: ${a.message}`)}}),vt=()=>{if(!c||!c.isConfigured){d.error("GitHub configuration is incomplete.");return}if(!c.repoUrl||!c.pat||!c.branch||!c.qqFileName){d.error("Essential GitHub details missing.");return}const a=h==="saved"?Q:Y;if(!a||a.length===0){d.info("No Q/Q data to save.");return}const r=a.filter(E=>E.question&&E.question.trim()!=="");if(r.length===0){d.info("No queries with valid questions to save.");return}const o=a.length-r.length;o>0&&d.warning(`${o} queries skipped (missing questions).`);const p=r.map(E=>({question_text:E.question.trim(),sql_query_text:E.sql})),P=`Saved Q/Q pairs from app. By: ${c.authorName||"RAG UI User"}`;d.info(`Attempting to save ${r.length} queries to GitHub...`),ie.mutate({git_config:{repo_url:c.repoUrl,branch:c.branch,github_pat:c.pat},target_file_name:c.qqFileName,qq_data:p,commit_message:P})},Ie=h==="saved"?Q.length>0:Y.length>0,yt=!Ie||!(c!=null&&c.isConfigured)||ie.isPending,St=c!=null&&c.isConfigured?Ie?"":"No data to save":"GitHub not configured.",be=C.isFetching&&h==="api",Ct=F.isFetching&&h==="demo queries",je=jt.isPending,ve=ie.isPending,wt=be||Ct||je||ve||N.isPending||q||x.isPending,Et=q?`Processing ${I.current}/${I.total}...`:N.isPending?"Fetching from GitHub...":"Bulk Process Q/Q (from GitHub)",Pt=q||N.isPending||!u||!(c!=null&&c.isConfigured);return z?e.jsx(_,{sx:{maxWidth:"var(--Content-maxWidth)",m:"var(--Content-margin)",p:"var(--Content-padding)",width:"var(--Content-width)"},children:e.jsx(tn,{query:z,onSave:bt,onCancel:pt})}):e.jsxs(e.Fragment,{children:[e.jsx(Bt,{children:e.jsx("title",{children:ln.title})}),e.jsx(_,{sx:{maxWidth:"var(--Content-maxWidth)",m:"var(--Content-margin)",p:"var(--Content-padding)",width:"var(--Content-width)"},children:e.jsxs(T,{spacing:4,children:[e.jsxs(T,{direction:{xs:"column",sm:"row"},spacing:3,sx:{alignItems:"flex-start"},children:[e.jsx(_,{sx:{flex:"1 1 auto"},children:e.jsx(j,{variant:"h4",children:"Queries"})}),e.jsxs(T,{direction:"row",spacing:1,sx:{alignItems:"center",flexWrap:"wrap"},children:[e.jsx(A,{variant:"contained",onClick:ae,size:"small",disabled:be,children:be?"LOADING API...":h.toUpperCase()}),e.jsxs(et,{anchorEl:f,open:$,onClose:re,children:[e.jsx(te,{onClick:()=>oe("demo queries"),children:"DEMO QUERIES"}),e.jsx(te,{onClick:()=>oe("api"),children:"API (LOAD TO SAVED)"}),e.jsx(te,{onClick:()=>oe("saved"),children:"SAVED (LOCAL)"})]}),e.jsx(Ce,{title:c!=null&&c.isConfigured?"Fetch Q/Q from GitHub to view/edit in 'Saved' list before processing":"GitHub is not configured",children:e.jsx("span",{children:e.jsx(A,{onClick:B,startIcon:e.jsx(ts,{}),variant:"outlined",color:"primary",disabled:!(c!=null&&c.isConfigured)||x.isPending||q||N.isPending,size:"small",children:x.isPending?"Loading to Saved...":"Load GitHub to Saved"})})}),e.jsx(Ce,{title:c!=null&&c.isConfigured?u?"":"GCP/API config missing for processing.":"GitHub is not configured for Q/Q file operations.",children:e.jsx("span",{children:e.jsx(A,{onClick:J,startIcon:e.jsx(ss,{}),variant:"contained",color:"secondary",disabled:Pt,size:"small",children:Et})})}),e.jsx(Ce,{title:St,children:e.jsx("span",{children:e.jsx(A,{onClick:vt,startIcon:e.jsx(st,{}),variant:"contained",color:"success",size:"small",disabled:yt||ve,children:ve?"Saving...":"Save to GitHub"})})}),e.jsx(A,{onClick:ge,startIcon:e.jsx(Wt,{}),variant:"outlined",size:"small",children:"Add New Query"})]})]}),!(c!=null&&c.isConfigured)&&e.jsxs(ke,{severity:"warning",sx:{my:2},children:["GitHub integration is not fully configured. Please visit the"," ",e.jsx(zt,{to:"/dashboard/settings/github-setup",children:e.jsx(j,{component:"span",color:"warning.dark",sx:{fontWeight:"bold",textDecoration:"underline",cursor:"pointer"},children:"GitHub Setup page"})})," ","to complete the configuration for Q/Q file operations."]}),!u&&e.jsx(ke,{severity:"warning",sx:{my:2},children:"GCP/API configuration is not loaded. Some operations will be unavailable."}),(je||ie.isPending||C.isFetching&&h==="api"||N.isPending||q)&&e.jsxs(j,{variant:"body2",sx:{textAlign:"center",my:2},children:[je&&"Initializing backend resources...",N.isPending&&"Fetching Q/Q pairs from GitHub...",q&&`Processing Q/Q items (${I.current}/${I.total})...`,ie.isPending&&"Saving Q/Q pairs to GitHub...",C.isFetching&&h==="api"&&"Fetching queries from API..."]}),q&&e.jsxs(_,{sx:{width:"100%",my:2},children:[e.jsxs(j,{variant:"body2",gutterBottom:!0,align:"center",children:["Processing item ",I.current," of ",I.total]}),e.jsx(ps,{variant:"determinate",value:I.total>0?I.current/I.total*100:0})]}),!q&&I.total>0&&e.jsxs(ne,{sx:{my:2,p:2},children:[e.jsx(j,{variant:"h6",children:"Processing Summary"}),e.jsxs(j,{children:["Total Items Attempted: ",I.total]}),e.jsxs(j,{color:"success.main",children:["Successful: ",V.successes]}),e.jsxs(j,{color:"error.main",children:["Failed: ",V.failures]}),V.errorDetails.length>0&&e.jsxs(Vt,{sx:{mt:1},TransitionProps:{unmountOnExit:!0},children:[e.jsx(Jt,{expandIcon:e.jsx(Js,{}),children:e.jsxs(j,{color:"error",children:["View ",V.errorDetails.length," Error Details"]})}),e.jsx(Kt,{sx:{maxHeight:"200px",overflowY:"auto"},children:e.jsx(Yt,{dense:!0,children:V.errorDetails.map((a,r)=>e.jsx(Xt,{divider:!0,children:e.jsx(es,{primaryTypographyProps:{variant:"body2",sx:{wordBreak:"break-word"}},secondaryTypographyProps:{variant:"caption",sx:{wordBreak:"break-word"}},primary:`Q: "${a.question.slice(0,70)}..." (ID: ${a.qq_id||"N/A"})`,secondary:`Error: ${a.error}`})},r))})})]})]}),e.jsxs(ne,{children:[e.jsx(nn,{filters:{statementType:l,question:b,sku:y},sortDir:g,statementTypes:Y?[...new Set(Y.map(a=>a.statementType).filter(Boolean))].sort():[]}),e.jsx(se,{}),e.jsx(_,{sx:{overflowX:"auto"},children:e.jsx(Ks,{rows:ht,loading:wt,onPreviewQuery:ct,onEditQueryWithForm:ut})}),e.jsx(se,{}),e.jsx(on,{count:xe.length,page:S,rowsPerPage:O,onChangePage:gt,onChangeRowsPerPage:ft})]})]})}),e.jsx(Xs,{open:!!M||W,query:M?mt:void 0,onClose:()=>{M&&dt(),W&&fe()},onSave:xt})]})}function cn(s,t){return t?[...s].sort((n,u)=>{const v=n.createdAt instanceof Date?n.createdAt.getTime():0,l=u.createdAt instanceof Date?u.createdAt.getTime():0;return t==="asc"?v-l:l-v}):s}function dn(s,{statementType:t,question:n,sku:u}){return s.filter(v=>!(t&&v.statementType!==t||n&&typeof v.question=="string"&&!v.question.toLowerCase().includes(n.toLowerCase())))}export{An as Page};
